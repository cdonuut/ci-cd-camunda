name: "Get Camunda Bearer Token"
description: "Fetches a fresh Camunda OAuth token using client credentials"
inputs:
  client_id:
    required: true
  client_secret:
    required: true
  audience:
    required: true

outputs:
  token:
    description: "The generated bearer token"

runs:
  using: "composite"
  steps:
    - name: Get Token
      id: get-token
      shell: bash
      run: |
        echo "ðŸ”Ž Curl preview (DO NOT LOG in production):"
        echo "curl -X POST https://login.cloud.camunda.io/oauth/token \\"
        echo "  -H 'Content-Type: application/x-www-form-urlencoded' \\"
        echo "  --data-urlencode 'grant_type=client_credentials' \\"
        echo "  --data-urlencode 'client_id=${{ inputs.client_id }}' \\"
        echo "  --data-urlencode 'client_secret=${{ inputs.client_secret }}' \\"
        echo "  --data-urlencode 'audience=${{ inputs.audience }}'"
        RESPONSE=$(curl -s --request POST \
        --url https://login.cloud.camunda.io/oauth/token \
        --header 'Content-Type: application/x-www-form-urlencoded' \
        --data-urlencode 'grant_type=client_credentials' \
        --data-urlencode "client_id=${{ inputs.client_id }}" \
        --data-urlencode "client_secret=${{ inputs.client_secret }}" \
        --data-urlencode "audience=${{ inputs.audience }}")

        ACCESS_TOKEN=$(echo "$RESPONSE" | jq -r '.access_token')
        echo "token=$ACCESS_TOKEN" >> $GITHUB_OUTPUT